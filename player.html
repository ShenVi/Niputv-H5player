<link rel="stylesheet" type="text/css" href="css/player.css">
<script type="text/javascript" src="https://mahdns-cdn-1251754029.cosgz.myqcloud.com/v2.1.4/jquery.min.js"></script>
<div class="niputv-player" id="niputv-player">

    <div class="niputv-player-video"><video src="video1.mp4" id="video"></video></div>
    <div class="niputv-player-control main" id="niputv-player-control">
        <div class="niputv-player-control-timeline main" id="play-filling_all">
            <div class="niputv-player-control-timeline filling" id="play-filling"></div>
        </div>
        <div class="niputv-player-control bottom">
            <div class="niputv-player-volume-poup" id="control-volume">
                <div class="niputv-player-volume-poup_control">
                    <div class="niputv-player-volume-poup_controlfilling" role="progressbar" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
            </div>
            
            <div class="niputv-player-control play" style="background: url(img/niputv-player-ico.png) 0px 0px no-repeat" id="control-play"></div>
            <div class="niputv-player-control time">
                <span id="play-nowtime">00:00</span> /
                <span id="play-total_length">00:00</span>
            </div>
            <div class="niputv-player-control full_screen" style="background: url(img/niputv-player-ico.png) 0px -55px no-repeat"></div>
            <div class="niputv-player-control full_screen" style="background: url(img/niputv-player-ico.png) 0px -105px no-repeat" id="control-volume_butt"></div>
            <div class="niputv-player-control video_sharpness">1080P</div>
        </div>
    </div>
    
</div>
<script type="text/javascript">
    /**播放器主体**/
    var video = document.getElementById("video");

    /**现在播放时间-视频总时长**/
    var play_nowtime = document.getElementById("play-nowtime");
    var play_total_length = document.getElementById("play-total_length");

    /**视频播放进度条**/
    var player_filling_all = document.getElementById("play-filling_all");
    var player_filling = document.getElementById("play-filling");

    /**播放控件**/
    var video_playbutt = document.getElementById("control-play");

    function formatTime(time) {
        var hour = Math.floor(time / 3600);
        var other = time % 3600;
        var minute = Math.floor(other / 60);
        var second = (other % 60).toFixed(0);
        var showTime = hour + ':' + minute + ':' + second;
        return showTime;
    };

    function play(){
        this.controls = true;
        if (video.paused) {
            video.play()
            video_playbutt.style.cssText = "background: url(img/niputv-player-ico.png) -100px -0px no-repeat";
        } else {
            video.pause()
            video_playbutt.style.cssText = "background: url(img/niputv-player-ico.png) 0px 0px no-repeat";
        }
    };


    $('#control-volume_butt').on('click', function() {
        if (video.muted == true) {
            video.muted = false;
            $('#control-volume_butt').attr("style","background: url(img/niputv-player-ico.png) 0px -105px no-repeat")
        } else {
            video.muted = true;
            $('#control-volume_butt').attr("style","background: url(img/niputv-player-ico.png) 0px -155px no-repeat")
        }
    });
    
$('.niputv-player-volume-poup_control').on('click mousewheel DOMMouseScroll', function(e) {
		e = e || window.event;
		volumeControl(e);
		e.stopPropagation();
		return false;
	});
    
$('video')[0].volume = 1;
 function volumeControl(e) {
		e = e || window.event;
		var eventype = e.type;
		var delta = (e.originalEvent.wheelDelta && (e.originalEvent.wheelDelta > 0 ? 1 : -1)) || (e.originalEvent.detail && (e.originalEvent.detail > 0 ? -1 : 1));
		var positions = 0;
		var percentage = 0;
		if (eventype == "click") {
			positions = $('.niputv-player-volume-poup_control').find('.niputv-player-volume-poup_controlfilling').offset().top - e.pageY;
			percentage = 100 * (positions + $('.niputv-player-volume-poup_control').find('.niputv-player-volume-poup_controlfilling').height()) / $('.niputv-player-volume-poup_control').height();
		} else if (eventype == "mousewheel" || eventype == "DOMMouseScroll") {
			percentage = 100 * ($('.niputv-player-volume-poup_control').find('.niputv-player-volume-poup_controlfilling').height() + delta) / $('.niputv-player-volume-poup_control').height();
		}
		if (percentage < 0) {
			percentage = 0;
		}
	
		if (percentage >= 100) {
			percentage = 100;
		}
		$('.niputv-player-volume-poup_controlfilling').css('height', percentage + '%');
		$('video')[0].volume = percentage / 100;
		e.stopPropagation();
		e.preventDefault();
	}   

	var timer=null;
	$('#control-volume_butt').on('mouseover',function(){
		clearInterval(timer);
			$('#control-volume').css('display','block');
		});
	$('#control-volume_butt').on('mouseout',function(){
		clearInterval(timer);
		timer=setTimeout(function (){
		$('#control-volume').css('display','none');
	}, 200);		
	});
    
     $("#control-play").click(function() {
         play()
     })    
    
    var timeDrag = false;
    $('#play-filling_all').mousedown(function (e) {
        timeDrag = true;
        updatebar(e.pageX);
    });
    $(document).mouseup(function (e) {
        if (timeDrag) {
            timeDrag = false;
            updatebar(e.pageX);
        }
    });
    $(document).mousemove(function (e) {
        if (timeDrag) {
            updatebar(e.pageX);
        }
    });

    var updatebar = function (x) {
        var progress = $('#play-filling_all');
        var maxduration = video.duration;
        var position = x - progress.offset().left;
        var percentage = 100 * position / progress.width();

        if (percentage > 100) {
            percentage = 100;
        }
        if (percentage < 0) {
            percentage = 0;
        }

        //Update progress bar and video currenttime
        $('#play-filling').css('width', percentage + '%');
        video.currentTime = maxduration * percentage / 100;
    };


    video.addEventListener("loadedmetadata", function () {
        var duration = video.duration;
        var showTime = formatTime(duration);
        play_total_length.innerHTML = showTime
    });

    video.addEventListener('timeupdate', function () {
        var currentTime = video.currentTime; //Get currenttime
        var showTime = formatTime(currentTime);
        var maxduration = video.duration; //Get myVideo duration
        var percentage = 100 * currentTime / maxduration; //in %
        player_filling.style.cssText = "width:" + percentage + "%";
        play_nowtime.innerHTML = showTime

    });
</script>